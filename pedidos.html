<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“¦ Painel de Pedidos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      background: #f9f9f9;
    }
    .pedido {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      padding: 15px;
      white-space: pre-wrap;
      font-size: 15px;
    }
    .botoes {
      margin-top: 10px;
    }
    .botoes button {
      margin-right: 10px;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>ğŸ“¦ Painel de Pedidos</h2>
<div id="lista-pedidos"></div>

<script>
  const URL_PLANILHA = "https://opensheet.elk.sh/1_KqTCa8u1G49hRs3Vzf-SfU_uGLSYXlK1sAJHMqR_Ic/Pedidos";

  function carregarPedidos() {
    fetch(URL_PLANILHA)
      .then(res => res.json())
      .then(pedidos => {
        const container = document.getElementById("lista-pedidos");
        container.innerHTML = "";

        pedidos.reverse().forEach(pedido => {
          const div = document.createElement("div");
          div.className = "pedido";

          const mensagem = formatarMensagem(pedido);

          div.innerHTML = `
            ${mensagem}
            <div class="botoes">
              <button onclick="imprimirTexto(\`${mensagem.replace(/`/g, "\\`")}\`)">ğŸ–¨ï¸ Imprimir</button>
            </div>
          `;
          container.appendChild(div);
        });
      })
      .catch(err => {
        document.getElementById("lista-pedidos").textContent = "Erro ao carregar pedidos.";
        console.error(err);
      });
  }

  function formatarMensagem(p) {
    const entregaOuRetirada = (p["Entrega/Retirada"] || "").toLowerCase() === "retirada"
      ? "ğŸ›ï¸ *RETIRADA NO LOCAL*"
      : `ğŸšš *ENTREGA*\nğŸ“ *Cidade:* ${p["Cidade"] || '-'}\nğŸ“ *Ponto de ReferÃªncia:* ${p["Ponto de ReferÃªncia"] || '-'}\nğŸ“ *Complemento:* ${p["Complemento"] || '-'}`;

    // Formatar Data/Hora separando
    let dataHora = p["Data/Hora"] || "";
    let data = "";
    let hora = "";
    if (dataHora.includes(" ")) {
      [data, hora] = dataHora.split(" ");
    } else {
      data = dataHora;
    }

    return `ğŸ‘‹ *NOVO PEDIDO*\n\n${entregaOuRetirada}\n\nğŸ“¦ *Itens:* ${p["Produtos"] || '-'}\nğŸ§® *Quantidade:* ${p["Quantidade"] || '-'}\nğŸ’° *PreÃ§o Total:* R$ ${p["PreÃ§o Total"] || '-'}\n\nğŸ‘¤ *Nome:* ${p["Nome do Cliente"] || '-'}\nğŸ“ *Contato:* ${p["NÃºmero do Cliente"] || '-'}\nğŸ“… *Data:* ${data}\nğŸ•’ *HorÃ¡rio:* ${hora}\n\nğŸ’³ *Forma de Pagamento:* ${p["Forma de Pagamento"] || '-'}`;
  }

  function imprimirTexto(texto) {
    const printWindow = window.open('', '_blank', 'width=600,height=600');
    printWindow.document.write(`<pre style="font-family: monospace; font-size: 16px;">${texto}</pre>`);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
  }

  carregarPedidos();
</script>

</body>
</html>
